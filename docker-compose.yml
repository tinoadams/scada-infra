version: "3.9"
    
services:
  graphite:
    # query test metric raw data
    # http://localhost:8080/render?format=json&target=randomWalk(%22machines.test1%22)
    image: graphiteapp/graphite-statsd:latest
    restart: always
    ports:
      - "8080:80"
      - "2003-2004:2003-2004"
      - "2023-2024:2023-2024"
      - "8125:8125/udp"
      - "8126:8126"
    environment:
      MYSQL_ROOT_PASSWORD: somewordpress
  grafana:
    # default dashboard
    # http://localhost:3000/d/21aYM4xnz/new-dashboard?orgId=1
    # test embed
    # http://localhost:3000/graphs/d-solo/21aYM4xnz/machine-dashboard?orgId=1&from=now-1h&to=now&panelId=5&refresh=5s&kiosk&var-machine_name=machine_2
    depends_on:
      - graphite
    image: grafana/grafana-oss:latest
    restart: always
    ports:
      - "3000:3000"
    volumes:
      - ./provisioning:/etc/grafana/provisioning
      - ./dashboards:/dashboards
      - ./config/grafana.ini:/etc/grafana/grafana.ini
#    environment:
#        GF_INSTALL_PLUGINS: "yesoreyeram-boomtheme-panel"
  nginx:
    # request the index page via
    # http://localhost:3080
    image: nginx
    restart: always
    ports:
      - "3080:80"
    volumes:
      - ./config/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./html:/usr/share/nginx/html

  video:
    # test video stream (use a video player like VLC to test)
    # rtsp://localhost:8554/test
    image: aler9/rtsp-simple-server:latest
    restart: always
    ports:
      - "8554:8554"
      - "1935:1935"
      - "8888:8888"
    environment:
      RTSP_PROTOCOLS: tcp
      RTSP_PATHS_TEST_SOURCE: rtsp://rtsp.stream/pattern